<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Himisiri - Share your thoughts anonymously</title>

    <!-- iOS Smart App Banner -->
    <meta
      name="apple-itunes-app"
      content="app-id=YOUR_APP_STORE_ID, app-argument=himisiri://open"
    />

    <!-- Android Chrome intent -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#4B50B2" />

    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="Himisiri" />
    <meta
      property="og:description"
      content="Share your thoughts anonymously and connect with others"
    />
    <meta property="og:image" content="https://himisiri.expo.app/icon.png" />
    <meta property="og:type" content="website" />

    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
      }

      .container {
        max-width: 400px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .logo {
        font-size: 2.5em;
        font-weight: bold;
        margin-bottom: 10px;
        color: #4b50b2;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .tagline {
        font-size: 1.1em;
        margin-bottom: 30px;
        opacity: 0.9;
      }

      .buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 30px;
      }

      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 50px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
      }

      .btn-primary {
        background: #4b50b2;
        color: white;
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .loading {
        font-size: 0.9em;
        opacity: 0.8;
        margin-top: 20px;
      }

      @media (max-width: 480px) {
        .container {
          margin: 20px;
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="logo">Himisiri</div>
      <div class="tagline">Share. Discover. Connect. Anonymously.</div>

      <div id="content">
        <p>Opening in app...</p>
        <div class="loading">
          If the app doesn't open automatically, use the buttons below.
        </div>
      </div>

      <div class="buttons">
        <a href="#" id="openAppBtn" class="btn btn-primary">Open in App</a>
        <a
          href="https://play.google.com/store/apps/details?id=com.mohamedodesu.himisiri"
          class="btn btn-secondary"
          >Download from Play Store</a
        >
        <a
          href="https://apps.apple.com/app/himisiri/idYOUR_APP_STORE_ID"
          class="btn btn-secondary"
          >Download from App Store</a
        >
      </div>
    </div>

    <script>
      (function () {
        // Get current URL path and query parameters
        const currentPath = window.location.pathname;
        const currentSearch = window.location.search;
        const fullPath = currentPath + currentSearch;

        // Construct deep link
        const deepLink = `himisiri:/${fullPath}`;
        const webFallback = window.location.href;

        console.log("Attempting to open deep link:", deepLink);

        // Function to attempt app opening
        function attemptAppOpen() {
          // For iOS
          if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            // Try to open the app
            window.location.href = deepLink;

            // Set a timeout to redirect to App Store if app doesn't open
            setTimeout(function () {
              if (document.visibilityState === "visible") {
                // App didn't open, show download options
                updateContent("app-not-installed");
              }
            }, 2000);
          }
          // For Android
          else if (/Android/.test(navigator.userAgent)) {
            // Create an intent URL
            const intentUrl = `intent:/${fullPath}#Intent;scheme=himisiri;package=com.mohamedodesu.himisiri;S.browser_fallback_url=${encodeURIComponent(window.location.href)};end`;

            try {
              window.location.href = intentUrl;
            } catch (e) {
              // Fallback for older Android versions
              window.location.href = deepLink;
              setTimeout(function () {
                if (document.visibilityState === "visible") {
                  updateContent("app-not-installed");
                }
              }, 2000);
            }
          }
          // For other platforms (Desktop, etc.)
          else {
            updateContent("desktop");
          }
        }

        // Function to update content based on state
        function updateContent(state) {
          const content = document.getElementById("content");
          const openAppBtn = document.getElementById("openAppBtn");

          switch (state) {
            case "app-not-installed":
              content.innerHTML = `
              <p>It looks like you don't have the Himisiri app installed.</p>
              <div class="loading">Download it below to continue!</div>
            `;
              openAppBtn.style.display = "none";
              break;

            case "desktop":
              content.innerHTML = `
              <p>Himisiri is designed for mobile devices.</p>
              <div class="loading">Scan the QR code or visit on your phone to get started!</div>
            `;
              openAppBtn.style.display = "none";
              break;

            default:
              openAppBtn.href = deepLink;
          }
        }

        // Set up the manual open button
        document.getElementById("openAppBtn").href = deepLink;

        // Handle visibility change (detect if user switched to app)
        document.addEventListener("visibilitychange", function () {
          if (document.visibilityState === "hidden") {
            // User likely switched to the app
            console.log("Page became hidden - app likely opened");
          }
        });

        // Auto-attempt to open app after a short delay
        setTimeout(attemptAppOpen, 500);

        // Fallback: if page is still visible after 3 seconds, show download options
        setTimeout(function () {
          if (document.visibilityState === "visible") {
            updateContent("app-not-installed");
          }
        }, 3000);
      })();
    </script>
  </body>
</html>
